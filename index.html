<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜ç­‰æ•°å­¦è¯¾å ‚æé—®è®¡åˆ†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0e2a, #1a2980);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.2; }
            100% { opacity: 1; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
            background: linear-gradient(to right, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .password-section {
            background: rgba(255, 255, 255, 0.08);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .password-section h2 {
            margin-bottom: 15px;
            font-size: 1.4rem;
            color: #a3d9ff;
        }
        
        .password-section input {
            padding: 10px 15px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            margin-right: 10px;
            width: 250px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }
        
        .password-section input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
        }
        
        .password-section button {
            padding: 10px 25px;
            font-size: 1.1rem;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .password-section button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .main-content {
            display: none;
            background: rgba(255, 255, 255, 0.08);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .image-container {
            margin: 15px auto 20px;
            position: relative;
            width: 240px;
            height: 240px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .student-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 40px rgba(79, 172, 254, 0.7);
            display: none;
            filter: 
                brightness(1.1) 
                contrast(1.05) 
                saturate(1.1)
                hue-rotate(-2deg)
                sepia(0.03);
            animation: imageGlow 2s infinite alternate;
            position: relative;
            z-index: 2;
        }
        
        .student-name-in-image {
            font-size: 2.2rem;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 0 0 20px rgba(255, 235, 59, 0.8);
            animation: selectedEffect 3s infinite alternate;
            display: none;
            text-align: center;
            width: 100%;
            position: absolute;
            z-index: 3;
        }
        
        /* æ·»åŠ æŸ”å…‰æ•ˆæœå±‚ */
        .image-container::before {
            content: '';
            position: absolute;
            top: -15px;
            left: -15px;
            right: -15px;
            bottom: -15px;
            background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .student-image.active + .image-container::before {
            opacity: 1;
        }
        
        @keyframes imageGlow {
            0% { 
                box-shadow: 0 0 30px rgba(79, 172, 254, 0.5);
                filter: 
                    brightness(1.1) 
                    contrast(1.05) 
                    saturate(1.1)
                    hue-rotate(-2deg)
                    sepia(0.03);
            }
            100% { 
                box-shadow: 0 0 50px rgba(79, 172, 254, 0.9);
                filter: 
                    brightness(1.15) 
                    contrast(1.1) 
                    saturate(1.15)
                    hue-rotate(-2deg)
                    sepia(0.05);
            }
        }
        
        .student-display {
            height: 60px;
            margin: 15px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .student-name {
            font-size: 2.2rem;
            font-weight: bold;
            color: #ffffff;
            transition: all 0.3s ease;
            position: absolute;
            width: 100%;
            text-align: center;
        }
        
        .student-name.rolling {
            animation: rollEffect 0.1s linear infinite;
        }
        
        @keyframes rollEffect {
            0% {
                transform: translateY(100%);
                opacity: 0;
            }
            10% {
                transform: translateY(0);
                opacity: 1;
            }
            90% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100%);
                opacity: 0;
            }
        }
        
        .student-name.selected {
            color: #ffeb3b;
            text-shadow: 0 0 20px rgba(255, 235, 59, 0.8);
            animation: selectedEffect 3s infinite alternate;
        }
        
        @keyframes selectedEffect {
            0% {
                transform: scale(0.95);
                text-shadow: 0 0 15px rgba(255, 235, 59, 0.7);
            }
            100% {
                transform: scale(1.05);
                text-shadow: 0 0 25px rgba(255, 235, 59, 0.9);
            }
        }
        
        .controls {
            margin: 20px 0 15px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .controls button {
            padding: 12px 25px;
            font-size: 1.1rem;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .controls button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .controls button.stop {
            background: linear-gradient(to right, #ff5e7d, #ff8a00);
        }
        
        .controls button.specify {
            background: linear-gradient(to right, #9c27b0, #e91e63);
        }
        
        .controls button.scoreboard {
            background: linear-gradient(to right, #4caf50, #8bc34a);
        }
        
        .specify-section {
            margin-top: 20px;
            display: none;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
        }
        
        .specify-section h3 {
            margin-bottom: 12px;
            font-size: 1.3rem;
            color: #a3d9ff;
        }
        
        .specify-section select {
            padding: 8px 12px;
            font-size: 1.1rem;
            border: none;
            border-radius: 6px;
            margin-right: 10px;
            width: 200px;
            background: rgba(0, 0, 0, 0.3);
            color: #ffeb3b;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .specify-section button {
            padding: 8px 20px;
            font-size: 1.1rem;
            background: linear-gradient(to right, #9c27b0, #e91e63);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .specify-section button:hover {
            transform: translateY(-2px);
        }
        
        .score-section {
            margin-top: 20px;
            display: none;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
        }
        
        .score-section h3 {
            margin-bottom: 12px;
            font-size: 1.3rem;
            color: #a3d9ff;
        }
        
        .score-section input {
            padding: 8px 12px;
            font-size: 1.1rem;
            border: none;
            border-radius: 6px;
            margin-right: 10px;
            width: 150px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .score-section button {
            padding: 8px 20px;
            font-size: 1.1rem;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .score-section button:hover {
            transform: translateY(-2px);
        }
        
        .message {
            font-size: 1.4rem;
            margin: 15px 0;
            color: #ffeb3b;
            text-shadow: 0 0 10px rgba(255, 235, 59, 0.7);
            animation: messagePulse 2s infinite alternate;
        }
        
        @keyframes messagePulse {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        .celebration {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 10;
            display: none;
        }
        
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            animation: firework 1.5s ease-out forwards;
        }
        
        @keyframes firework {
            0% {
                transform: translate(var(--x), var(--y));
                width: 5px;
                height: 5px;
                opacity: 1;
            }
            50% {
                width: 5px;
                height: 5px;
                opacity: 1;
            }
            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }
        
        .sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="yellow" d="M12,2L9,12L2,12L10,17L7,22L12,17L17,22L14,17L22,12L15,12L12,2Z"/></svg>') no-repeat center;
            background-size: contain;
            animation: sparkle 2s infinite alternate;
        }
        
        @keyframes sparkle {
            0% { transform: scale(0.8) rotate(0deg); opacity: 0.7; }
            100% { transform: scale(1.2) rotate(180deg); opacity: 1; }
        }
        
        /* åˆ†æ•°åŠ¨ç”»æ•ˆæœ */
        .score-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .score-display {
            font-size: 6rem;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 0 0 20px rgba(255, 235, 59, 0.8);
            animation: scoreAnimation 4s ease-out forwards;
            position: absolute;
            opacity: 0;
        }
        
        @keyframes scoreAnimation {
            0% {
                transform: scale(0.5) translateY(0);
                opacity: 0;
            }
            20% {
                transform: scale(1.2) translateY(-20px);
                opacity: 1;
            }
            40% {
                transform: scale(1.5) translateY(-40px);
                opacity: 1;
            }
            60% {
                transform: scale(1.2) translateY(-80px);
                opacity: 0.8;
            }
            80% {
                transform: scale(0.8) translateY(-120px);
                opacity: 0.5;
            }
            100% {
                transform: scale(0.5) translateY(-160px);
                opacity: 0;
            }
        }
        
        .system-info {
            margin-top: 20px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .save-status {
            margin-top: 10px;
            font-size: 0.85rem;
            color: #4caf50;
            display: none;
        }

        /* GitHub Token è®¾ç½®åŒºåŸŸ */
        .github-token-section {
            position: fixed;
            bottom: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            z-index: 100;
            width: 250px;
            transition: all 0.3s ease;
        }

        .github-token-section.collapsed {
            width: 40px;
            height: 40px;
            overflow: hidden;
        }

        .github-token-section.collapsed .token-content {
            display: none;
        }

        .token-toggle {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .token-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .token-content h4 {
            margin-bottom: 8px;
            color: #a3d9ff;
            font-size: 0.85rem;
        }

        .token-content input {
            width: 100%;
            padding: 6px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
            font-size: 0.75rem;
        }

        .token-content button {
            width: 100%;
            padding: 6px;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .token-content button:hover {
            opacity: 0.9;
        }

        .token-status {
            margin-top: 6px;
            font-size: 0.65rem;
            color: #4caf50;
            display: none;
        }

        /* å¾—åˆ†æ¦œå¼¹çª—æ ·å¼ */
        .scoreboard-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .scoreboard-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            min-width: 500px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
        }

        .scoreboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .scoreboard-header h2 {
            color: #ffeb3b;
            font-size: 1.6rem;
            text-shadow: 0 0 10px rgba(255, 235, 59, 0.5);
        }

        .scoreboard-buttons {
            display: flex;
            gap: 10px;
        }

        .download-scoreboard {
            background: linear-gradient(to right, #ff9800, #ff5722);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .download-scoreboard:hover {
            opacity: 0.9;
        }

        .refresh-scoreboard {
            background: linear-gradient(to right, #4caf50, #8bc34a);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        .refresh-scoreboard:hover {
            opacity: 0.9;
        }

        .close-scoreboard {
            background: none;
            border: none;
            color: white;
            font-size: 1.6rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-scoreboard:hover {
            color: #ffeb3b;
        }

        .scoreboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .scoreboard-table th,
        .scoreboard-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .scoreboard-table th {
            background: rgba(255, 255, 255, 0.1);
            color: #ffeb3b;
            font-size: 1rem;
        }

        .scoreboard-table td {
            font-size: 0.9rem;
        }

        .scoreboard-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .scoreboard-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.03);
        }

        .loading-message {
            text-align: center;
            padding: 15px;
            color: #a3d9ff;
            font-size: 1rem;
        }

        .error-message {
            text-align: center;
            padding: 15px;
            color: #ff6b6b;
            font-size: 0.9rem;
        }
        
        /* å¤´åƒé¢„åŠ è½½åŒºåŸŸ */
        .image-preload {
            display: none;
        }
        
        /* é¢„åŠ è½½çŠ¶æ€ä¿¡æ¯ */
        .preload-status {
            margin-top: 10px;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
            text-align: center;
        }
        
        .preload-status .success {
            color: rgba(76, 175, 80, 0.7);
        }
        
        .preload-status .loading {
            color: rgba(255, 152, 0, 0.7);
        }
        
        .preload-status .error {
            color: rgba(244, 67, 54, 0.7);
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="celebration" id="celebration"></div>
    <div class="score-animation" id="scoreAnimation"></div>
    
    <div class="container">
        <h1>é«˜ç­‰æ•°å­¦è¯¾å ‚æé—®è®¡åˆ†ç³»ç»Ÿ</h1>
        
        <div class="password-section" id="passwordSection">
            <h2>è¯·è¾“å…¥å¯†ç å¯åŠ¨ç³»ç»Ÿ</h2>
            <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥å¯†ç ">
            <button id="submitPassword">ç¡®è®¤</button>
        </div>
        
        <div class="main-content" id="mainContent">
            <div class="image-container">
                <img class="student-image" id="studentImage" alt="å­¦ç”Ÿå¤´åƒ">
                <div class="student-name-in-image" id="studentNameInImage"></div>
            </div>
            
            <div class="student-display">
                <div class="student-name" id="studentName"></div>
            </div>
            
            <div class="message" id="message"></div>
            
            <div class="controls">
                <button id="startBtn">å¼€å§‹ç‚¹å</button>
                <button id="stopBtn" class="stop">åœæ­¢ç‚¹å</button>
                <button id="specifyBtn" class="specify">æŒ‡å®šå­¦ç”Ÿ</button>
                <button id="scoreboardBtn" class="scoreboard">å¾—åˆ†æ¦œ</button>
            </div>
            
            <div class="specify-section" id="specifySection">
                <h3>è¯·é€‰æ‹©è¦æŒ‡å®šçš„å­¦ç”Ÿ</h3>
                <select id="studentSelect">
                    <option value="">-- è¯·é€‰æ‹©å­¦ç”Ÿ --</option>
                </select>
                <button id="confirmSpecify">ç¡®è®¤æŒ‡å®š</button>
            </div>
            
            <div class="score-section" id="scoreSection">
                <h3>è¯·ä¸º <span id="scoringStudent"></span> åŒå­¦æ‰“åˆ†</h3>
                <input type="number" id="scoreInput" min="-100" max="100" placeholder="è¾“å…¥åˆ†æ•° (-100åˆ°100)">
                <button id="submitScore">æäº¤åˆ†æ•°</button>
                <div class="save-status" id="saveStatus"></div>
            </div>
            
            <div class="system-info">
                <p>ç³»ç»Ÿæç¤ºï¼šç‚¹å‡»"å¼€å§‹ç‚¹å"æŒ‰é’®å¼€å§‹éšæœºé€‰æ‹©å­¦ç”Ÿï¼Œç‚¹å‡»"åœæ­¢ç‚¹å"æŒ‰é’®å¯æå‰ç»“æŸé€‰æ‹©ï¼Œç‚¹å‡»"æŒ‡å®šå­¦ç”Ÿ"æŒ‰é’®å¯æ‰‹åŠ¨é€‰æ‹©å­¦ç”Ÿ</p>
                <p style="margin-top: 8px; color: #4caf50;">åˆ†æ•°å°†è‡ªåŠ¨ä¿å­˜åˆ°è¿œç¨‹æœåŠ¡å™¨</p>
                <p style="margin-top: 5px; color: #ff9800;">2025çº§é«˜æ•°B3ç­ä¸“äº«</p>
                <div class="preload-status" id="preloadStatus">
                    <div>å¤´åƒé¢„åŠ è½½ï¼š<span id="imagePreloadStatus">æœªå¼€å§‹</span></div>
                    <div>å¾—åˆ†æ¦œé¢„åŠ è½½ï¼š<span id="scoreboardPreloadStatus">æœªå¼€å§‹</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¤´åƒé¢„åŠ è½½åŒºåŸŸ -->
    <div class="image-preload" id="imagePreload"></div>

    <!-- GitHub Token è®¾ç½®åŒºåŸŸ -->
    <div class="github-token-section collapsed" id="githubTokenSection">
        <button class="token-toggle" id="tokenToggle">âš™ï¸</button>
        <div class="token-content">
            <h4>GitHub Token è®¾ç½®</h4>
            <input type="password" id="githubTokenInput" placeholder="è¾“å…¥ GitHub Token">
            <button id="saveToken">ä¿å­˜ Token</button>
            <div class="token-status" id="tokenStatus">Token å·²ä¿å­˜</div>
        </div>
    </div>

    <!-- å¾—åˆ†æ¦œå¼¹çª— -->
    <div class="scoreboard-modal" id="scoreboardModal">
        <div class="scoreboard-content">
            <div class="scoreboard-header">
                <h2>å­¦ç”Ÿå¾—åˆ†æ¦œ</h2>
                <div class="scoreboard-buttons">
                    <button class="download-scoreboard" id="downloadScoreboard">
                        <span>ğŸ“¥</span> ä¸‹è½½
                    </button>
                    <button class="refresh-scoreboard" id="refreshScoreboard">åˆ·æ–°</button>
                    <button class="close-scoreboard" id="closeScoreboard">&times;</button>
                </div>
            </div>
            <div id="scoreboardData">
                <div class="loading-message">æ­£åœ¨åŠ è½½å¾—åˆ†æ•°æ®...</div>
            </div>
        </div>
    </div>

    <script>
        // å­¦ç”Ÿåå•
        const students = [
            "å¾è‹¥ä¼½", "ç¨‹å­æ˜‚", "æœ±é™è•¾", "ç‹ç¡•", "é‚¹å¥ä¹", "å´å­æ¶µ", "å¼ æ€¡", "èƒ¡æ’è¿œ", "å¤å¤©é¦™", "è°¢æ¶µ",
            "æœ±èŠ®", "ææ¬£æ€¡", "ä¿å…‰ç‡•", "éƒ­è‹±å§¿", "å¼ å¤©ä¹", "æä¹ä¹", "æå¿—è±ª", "æ¨ç¡•", "æ¨é‹†å¦", "é‡‘å®‡",
            "èƒ¡æ–‡è¿œ", "èƒ¡é›¨æ¬£", "å¸¸ä¿Š", "éŸ¦ä¹¦æˆ", "æ±¤å­æ‰¬", "é˜®å®¶è±ª", "ä½•ä¿Šæ°", "å•å®‡é˜³", "å§šå‹‡æ£‹", "æ®µæµ·å†°",
            "å”äºš", "é²ç‘é”‹", "è”¡è´¤è¿", "æ–¹æµ·æ¶›", "éŸ¦å®‡æ’", "éŸ¦å˜‰ä¹", "ç‹æ˜Šå®‡", "ç‹ç‘ç¦", "å¶å•Ÿå†›", "å¹´åšä¸€",
            "åˆ˜å­é¾™", "åˆ˜ç‘", "æœ±å‹‹æŒ¯", "å¼ å®‡æ´‹", "å¼ æµ©å®‡", "æä¿Šæ°", "æ¨æ–‡å®‡", "æ¨æ ‘å›­", "æ¨ç››æµ©", "å”å¿—è¿œ",
            "å¤äº‘å‹‡", "è°¢è¶…", "æ¯›è¿æœ", "éŸ¦ç‰", "å­™è€€å¤", "æœ±è¡Œè·ƒ", "é™ˆå¯ç¿", "å§šæ™ºé¹", "éŸ©ç´«å«£", "ç‹ç«¥",
            "å¶å©·å©·", "ç«¥æ¬£æ€¡", "èˆ’æ™ºæ–‡", "éŸ©ç‰æ´", "æ¢æ™–", "è°­æ…§æ…§", "é©¬é‘«å®‡", "å­”è‰ºæ¶µ", "æ–¹ç‰è¾¾", "ç‹æ¢¦äº‘",
            "å¼ æ¢¦å©·", "æˆ¿é“¶éœ", "æ¢å¿ƒæ€¡", "æ¢å®‡ç¨", "éœæµ©ç„¶", "ä¸å®‡è½©", "é©¬è‡ªçº¢", "ç‰›å¥½", "æ±Ÿæµ·æ¶›", "å¼ å®¶ç¦",
            "ç½—æ—¶æ­¦", "èƒ¡è€€", "èµµç´«æ¶µ", "é«˜åº†é¹", "ç››æ–‡æ¶›", "åå‹‡ä¹", "æœ±è´¤æ¶›", "å¼ ç‰æ´", "å¼ é¸£å¨", "å¼ æ’",
            "æ¨ä½³æ€¡", "é™ˆå®¶ä¹", "æ˜åä¸œ", "å§šçŒ›", "é¡¹å¯ç›Š", "æ¹›ç›Šé˜³"
        ];

        // GitHubé…ç½®ï¼ˆç”¨æˆ·åå’Œä»“åº“åç§°åœ¨ä»£ç ä¸­è®¾ç½®ï¼‰
        const GITHUB_CONFIG = {
            owner: "QingYH",           // æ›¿æ¢ä¸ºæ‚¨çš„GitHubç”¨æˆ·å
            repo: "RandRoll"            // æ›¿æ¢ä¸ºæ‚¨çš„ä»“åº“åç§°
        };

        // å…¨å±€å˜é‡ - å­˜å‚¨å¾—åˆ†æ¦œæ•°æ®
        let scoreboardDataCache = null;
        let lastScoreboardUpdate = 0;
        const SCOREBOARD_CACHE_DURATION = 30000; // 30ç§’ç¼“å­˜
        
        // å¤´åƒåŠ è½½å¤±è´¥é‡è¯•æœºåˆ¶
        let failedImages = new Set();
        let imageRetryInterval = null;
        
        // å¾—åˆ†æ¦œè‡ªåŠ¨æ›´æ–°æœºåˆ¶
        let scoreboardAutoUpdateInterval = null;

        // åˆ›å»ºé—ªçƒçš„æ˜Ÿæ˜Ÿ
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 150;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // éšæœºä½ç½®å’Œå¤§å°
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                star.style.animationDelay = `${Math.random() * 2}s`;
                
                starsContainer.appendChild(star);
            }
        }

        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
        function createFireworks() {
            const celebration = document.getElementById('celebration');
            celebration.style.display = 'block';
            
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.classList.add('firework');
                    
                    // éšæœºé¢œè‰²
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.backgroundColor = color;
                    
                    // éšæœºä½ç½®
                    const x = Math.random() * 100;
                    const y = Math.random() * 100;
                    firework.style.setProperty('--x', `${x}vw`);
                    firework.style.setProperty('--y', `${y}vh`);
                    
                    // éšæœºå¤§å°å’ŒåŠ¨ç”»å»¶è¿Ÿ
                    firework.style.animationDelay = `${Math.random() * 0.5}s`;
                    
                    celebration.appendChild(firework);
                    
                    // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                    setTimeout(() => {
                        firework.remove();
                    }, 1500);
                }, i * 100);
            }
            
            // 5ç§’åéšè—åº†ç¥æ•ˆæœ
            setTimeout(() => {
                celebration.style.display = 'none';
            }, 5000);
        }

        // åˆ›å»ºé—ªçƒçš„å°æ˜Ÿæ˜Ÿæ•ˆæœ
        function createSparkles() {
            const container = document.querySelector('.student-display');
            const sparkleCount = 10;
            
            for (let i = 0; i < sparkleCount; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle');
                
                // éšæœºä½ç½®
                sparkle.style.left = `${Math.random() * 100}%`;
                sparkle.style.top = `${Math.random() * 100}%`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                sparkle.style.animationDelay = `${Math.random() * 2}s`;
                
                container.appendChild(sparkle);
                
                // 5ç§’åç§»é™¤
                setTimeout(() => {
                    sparkle.remove();
                }, 5000);
            }
        }

        // æ˜¾ç¤ºåˆ†æ•°åŠ¨ç”»
        function showScoreAnimation(score) {
            const scoreAnimation = document.getElementById('scoreAnimation');
            const scoreDisplay = document.createElement('div');
            scoreDisplay.classList.add('score-display');
            
            // è®¾ç½®åˆ†æ•°é¢œè‰²
            if (score > 0) {
                scoreDisplay.style.color = '#4caf50'; // æ­£åˆ†ç»¿è‰²
            } else if (score < 0) {
                scoreDisplay.style.color = '#f44336'; // è´Ÿåˆ†çº¢è‰²
            } else {
                scoreDisplay.style.color = '#ffeb3b'; // é›¶åˆ†é»„è‰²
            }
            
            scoreDisplay.textContent = (score > 0 ? '+' : '') + score;
            scoreAnimation.appendChild(scoreDisplay);
            
            // 4ç§’åç§»é™¤åˆ†æ•°æ˜¾ç¤º
            setTimeout(() => {
                scoreDisplay.remove();
            }, 4000);
        }

        // ä¸‹è½½å¾—åˆ†æ¦œä¸ºExcelæ–‡ä»¶
        function downloadScoreboardAsExcel() {
            if (!scoreboardDataCache || scoreboardDataCache.length === 0) {
                alert('æš‚æ— å¾—åˆ†æ•°æ®å¯ä¸‹è½½');
                return;
            }
            
            // åˆ›å»ºExcelå†…å®¹
            let excelContent = "æ’å,å§“å,æ€»åˆ†\n";
            
            scoreboardDataCache.forEach((item, index) => {
                excelContent += `${index + 1},${item.name},${item.totalScore}\n`;
            });
            
            // åˆ›å»ºBlobå¯¹è±¡
            const blob = new Blob([excelContent], { type: 'text/csv;charset=utf-8;' });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `é«˜æ•°B3ç­å¾—åˆ†æ¦œ_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            
            // æ·»åŠ åˆ°æ–‡æ¡£å¹¶è§¦å‘ä¸‹è½½
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // è·å–ä¿å­˜çš„GitHub Token
        function getGitHubToken() {
            return localStorage.getItem('githubToken');
        }

        // ä¿å­˜GitHub Token
        function saveGitHubToken(token) {
            localStorage.setItem('githubToken', token);
            showTokenStatus('Token å·²ä¿å­˜');
        }

        // æ¸…é™¤GitHub Token
        function clearGitHubToken() {
            localStorage.removeItem('githubToken');
        }

        // æ˜¾ç¤ºTokençŠ¶æ€
        function showTokenStatus(message) {
            const statusElement = document.getElementById('tokenStatus');
            statusElement.textContent = message;
            statusElement.style.display = 'block';
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        // ä¿å­˜åˆ†æ•°åˆ°GitHubï¼ˆè¿½åŠ æ¨¡å¼ï¼‰
        async function saveScoreToGitHub(studentName, score) {
            const token = getGitHubToken();
            
            // æ£€æŸ¥GitHubé…ç½®æ˜¯å¦å®Œæ•´
            if (!token) {
                showSaveStatus(false, 'è¯·å…ˆè®¾ç½®GitHub Token');
                return false;
            }

            if (!GITHUB_CONFIG.owner || GITHUB_CONFIG.owner === "YOUR_USERNAME" || 
                !GITHUB_CONFIG.repo || GITHUB_CONFIG.repo === "YOUR_REPO_NAME") {
                showSaveStatus(false, 'GitHubé…ç½®ä¸å®Œæ•´ï¼Œè¯·æ£€æŸ¥ä»£ç ä¸­çš„GITHUB_CONFIG');
                return false;
            }

            const record = {
                name: studentName,
                score: score,
                date: new Date().toLocaleString('zh-CN')
            };
            
            const filename = `records/${studentName}.txt`;

            try {
                // é¦–å…ˆæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                const checkResponse = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${encodeURIComponent(filename)}`,
                    {
                        method: 'GET',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );

                let existingContent = '';
                let sha = null;

                if (checkResponse.status === 200) {
                    const fileData = await checkResponse.json();
                    sha = fileData.sha;
                    // è§£ç ç°æœ‰å†…å®¹
                    existingContent = decodeURIComponent(escape(atob(fileData.content)));
                }

                // æ„å»ºæ–°çš„æ–‡ä»¶å†…å®¹ï¼ˆè¿½åŠ æ¨¡å¼ï¼‰
                const newRecord = `å§“åï¼š${record.name}\nåˆ†æ•°ï¼š${record.score}\næ—¥æœŸï¼š${record.date}\n${'-'.repeat(30)}\n`;
                const newContent = existingContent + newRecord;
                const encodedContent = btoa(unescape(encodeURIComponent(newContent)));

                // åˆ›å»ºæˆ–æ›´æ–°æ–‡ä»¶ - ä½¿ç”¨è‹±æ–‡commit messageé¿å…ç¼–ç é—®é¢˜
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${encodeURIComponent(filename)}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Add score for ${studentName} - ${new Date().toISOString()}`,
                            content: encodedContent,
                            sha: sha,
                            branch: 'main'
                        })
                    }
                );

                if (response.ok) {
                    showSaveStatus(true, 'åˆ†æ•°å·²ä¿å­˜åˆ°GitHubä»“åº“ï¼');
                    
                    // æ˜¾ç¤ºåˆ†æ•°åŠ¨ç”»
                    showScoreAnimation(parseInt(score));
                    
                    // åˆ†æ•°ä¿å­˜æˆåŠŸåï¼Œç«‹å³æ›´æ–°å¾—åˆ†æ¦œç¼“å­˜
                    updateScoreboardCache();
                    
                    // è¯­éŸ³æ’­æŠ¥ä¿å­˜æˆåŠŸ
                    const speech = new SpeechSynthesisUtterance("æ‚¨çš„å¾—åˆ†å·²ä¿å­˜è‡³æœåŠ¡å™¨ï¼Œå¾—åˆ†æ¦œå·²æ›´æ–°");
                    speech.lang = 'zh-CN';
                    speech.rate = 1.0;
                    speech.pitch = 1.0;
                    window.speechSynthesis.speak(speech);
                    
                    return true;
                } else {
                    const error = await response.json();
                    showSaveStatus(false, `ä¿å­˜å¤±è´¥: ${error.message}`);
                    return false;
                }
            } catch (error) {
                showSaveStatus(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
                return false;
            }
        }

        // æ˜¾ç¤ºä¿å­˜çŠ¶æ€
        function showSaveStatus(success, message) {
            const statusElement = document.getElementById('saveStatus');
            statusElement.textContent = message;
            statusElement.style.color = success ? '#4caf50' : '#f44336';
            statusElement.style.display = 'block';
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 5000);
        }

        // è·å–æ‰€æœ‰åˆ†æ•°è®°å½•å¹¶è®¡ç®—æ€»åˆ†
        async function getScoreboardData() {
            const token = getGitHubToken();
            
            if (!token) {
                return { error: 'è¯·å…ˆè®¾ç½®GitHub Token' };
            }

            try {
                // è·å–recordsç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ - ä½¿ç”¨encodeURIComponentå¤„ç†è·¯å¾„
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${encodeURIComponent('records')}`,
                    {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );

                if (!response.ok) {
                    if (response.status === 404) {
                        return { error: 'recordsç›®å½•ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºrecordsç›®å½•æˆ–ä¿å­˜ä¸€äº›åˆ†æ•°æ•°æ®' };
                    }
                    const errorData = await response.json();
                    return { error: `GitHub APIé”™è¯¯: ${errorData.message}` };
                }

                const files = await response.json();
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯ç©ºç›®å½•
                if (!files || files.length === 0) {
                    return { error: 'recordsç›®å½•ä¸ºç©ºï¼Œè¯·å…ˆä¿å­˜ä¸€äº›åˆ†æ•°æ•°æ®' };
                }

                const scoreMap = new Map();

                // å¤„ç†æ¯ä¸ªæ–‡ä»¶
                for (const file of files) {
                    if (file.name.endsWith('.txt')) {
                        try {
                            // è·å–æ–‡ä»¶å†…å®¹
                            const fileResponse = await fetch(file.download_url);
                            if (!fileResponse.ok) {
                                console.warn(`æ— æ³•è·å–æ–‡ä»¶ ${file.name} çš„å†…å®¹`);
                                continue;
                            }
                            
                            const content = await fileResponse.text();
                            console.log(`å¤„ç†æ–‡ä»¶ ${file.name}:`, content);
                            
                            // æŒ‰åˆ†éš”ç¬¦åˆ†å‰²è®°å½•
                            const records = content.split('-'.repeat(30));
                            const fileNameStudent = file.name.replace('.txt', '');
                            
                            for (const record of records) {
                                if (record.trim() === '') continue;
                                
                                const lines = record.split('\n');
                                let score = 0;
                                let foundScore = false;
                                
                                for (const line of lines) {
                                    const trimmedLine = line.trim();
                                    if (trimmedLine.startsWith('åˆ†æ•°ï¼š')) {
                                        const scoreStr = trimmedLine.replace('åˆ†æ•°ï¼š', '').trim();
                                        score = parseInt(scoreStr);
                                        if (!isNaN(score)) {
                                            foundScore = true;
                                            break;
                                        }
                                    }
                                }
                                
                                if (foundScore && !isNaN(score)) {
                                    // ç´¯åŠ åŒä¸€å­¦ç”Ÿçš„æ‰€æœ‰åˆ†æ•°
                                    if (scoreMap.has(fileNameStudent)) {
                                        scoreMap.set(fileNameStudent, scoreMap.get(fileNameStudent) + score);
                                    } else {
                                        scoreMap.set(fileNameStudent, score);
                                    }
                                    console.log(`å­¦ç”Ÿ ${fileNameStudent} å¾—åˆ†: ${score}, å½“å‰æ€»åˆ†: ${scoreMap.get(fileNameStudent)}`);
                                }
                            }
                        } catch (fileError) {
                            console.error(`å¤„ç†æ–‡ä»¶ ${file.name} æ—¶å‡ºé”™:`, fileError);
                        }
                    }
                }

                // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
                const scoreArray = Array.from(scoreMap.entries())
                    .map(([name, totalScore]) => ({ name, totalScore }))
                    .sort((a, b) => b.totalScore - a.totalScore);

                console.log('æœ€ç»ˆå¾—åˆ†æ¦œæ•°æ®:', scoreArray);
                return { data: scoreArray };

            } catch (error) {
                console.error('è·å–å¾—åˆ†æ¦œæ•°æ®å¤±è´¥:', error);
                return { error: `ç½‘ç»œé”™è¯¯: ${error.message}` };
            }
        }

        // æ›´æ–°å¾—åˆ†æ¦œç¼“å­˜
        async function updateScoreboardCache() {
            const statusElement = document.getElementById('scoreboardPreloadStatus');
            statusElement.textContent = 'æ­£åœ¨æ›´æ–°...';
            statusElement.className = 'loading';
            
            try {
                const result = await getScoreboardData();
                
                if (result.error) {
                    scoreboardDataCache = null;
                    statusElement.textContent = `åŠ è½½å¤±è´¥ - ${result.error}`;
                    statusElement.className = 'error';
                } else {
                    scoreboardDataCache = result.data;
                    lastScoreboardUpdate = Date.now();
                    statusElement.textContent = `å·²åŠ è½½ (${result.data.length}åå­¦ç”Ÿ)`;
                    statusElement.className = 'success';
                }
            } catch (error) {
                scoreboardDataCache = null;
                statusElement.textContent = `åŠ è½½å¤±è´¥ - ${error.message}`;
                statusElement.className = 'error';
            }
        }

        // æ˜¾ç¤ºå¾—åˆ†æ¦œ
        async function showScoreboard() {
            const modal = document.getElementById('scoreboardModal');
            modal.style.display = 'block';
            
            // å¦‚æœç¼“å­˜è¶…è¿‡30ç§’ï¼Œåˆ™é‡æ–°åŠ è½½
            const now = Date.now();
            if (!scoreboardDataCache || (now - lastScoreboardUpdate) > SCOREBOARD_CACHE_DURATION) {
                await updateScoreboardCache();
            }
            
            await updateScoreboardDisplay();
        }

        // æ›´æ–°å¾—åˆ†æ¦œæ˜¾ç¤º
        async function updateScoreboardDisplay() {
            const scoreboardData = document.getElementById('scoreboardData');
            
            // å¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜
            if (scoreboardDataCache) {
                renderScoreboard(scoreboardDataCache);
                return;
            }
            
            // å¦åˆ™æ˜¾ç¤ºåŠ è½½ä¸­
            scoreboardData.innerHTML = '<div class="loading-message">æ­£åœ¨åŠ è½½å¾—åˆ†æ•°æ®...</div>';
            
            const result = await getScoreboardData();
            
            if (result.error) {
                scoreboardData.innerHTML = `<div class="error-message">${result.error}</div>`;
                return;
            }
            
            if (result.data && result.data.length > 0) {
                renderScoreboard(result.data);
            } else {
                scoreboardData.innerHTML = '<div class="loading-message">æš‚æ— å¾—åˆ†æ•°æ®</div>';
            }
        }

        // æ¸²æŸ“å¾—åˆ†æ¦œ
        function renderScoreboard(data) {
            const scoreboardData = document.getElementById('scoreboardData');
            
            let html = `
                <table class="scoreboard-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>å§“å</th>
                            <th>æ€»åˆ†</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.forEach((item, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.name}</td>
                        <td>${item.totalScore}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            scoreboardData.innerHTML = html;
        }

        // é¢„åŠ è½½æ‰€æœ‰å­¦ç”Ÿå¤´åƒ
        function preloadStudentImages() {
            const statusElement = document.getElementById('imagePreloadStatus');
            statusElement.textContent = 'æ­£åœ¨åŠ è½½...';
            statusElement.className = 'loading';
            
            const preloadContainer = document.getElementById('imagePreload');
            let loadedCount = 0;
            let errorCount = 0;
            
            students.forEach(student => {
                const img = new Image();
                img.src = `images/${student}.jpg`;
                img.alt = `${student}çš„å¤´åƒ`;
                
                img.onload = function() {
                    loadedCount++;
                    updatePreloadStatus(loadedCount, errorCount);
                };
                
                img.onerror = function() {
                    errorCount++;
                    failedImages.add(student);
                    updatePreloadStatus(loadedCount, errorCount);
                };
                
                preloadContainer.appendChild(img);
            });
            
            function updatePreloadStatus(loaded, errors) {
                if (loaded + errors === students.length) {
                    if (errors === 0) {
                        statusElement.textContent = `å·²åŠ è½½ ${loaded} ä¸ªå¤´åƒ`;
                        statusElement.className = 'success';
                    } else {
                        statusElement.textContent = `å·²åŠ è½½ ${loaded} ä¸ªå¤´åƒï¼Œ${errors} ä¸ªå¤±è´¥`;
                        statusElement.className = 'error';
                        
                        // å¦‚æœæœ‰å¤±è´¥çš„å¤´åƒï¼Œå¯åŠ¨é‡è¯•æœºåˆ¶
                        if (errors > 0 && !imageRetryInterval) {
                            startImageRetryMechanism();
                        }
                    }
                } else {
                    statusElement.textContent = `æ­£åœ¨åŠ è½½... (${loaded + errors}/${students.length})`;
                    statusElement.className = 'loading';
                }
            }
        }
        
        // å¯åŠ¨å¤´åƒé‡è¯•æœºåˆ¶
        function startImageRetryMechanism() {
            if (imageRetryInterval) {
                clearInterval(imageRetryInterval);
            }
            
            imageRetryInterval = setInterval(() => {
                if (failedImages.size === 0) {
                    clearInterval(imageRetryInterval);
                    imageRetryInterval = null;
                    return;
                }
                
                console.log(`å°è¯•é‡æ–°åŠ è½½ ${failedImages.size} ä¸ªå¤±è´¥çš„å¤´åƒ...`);
                
                const preloadContainer = document.getElementById('imagePreload');
                const statusElement = document.getElementById('imagePreloadStatus');
                
                failedImages.forEach(student => {
                    const img = new Image();
                    img.src = `images/${student}.jpg`;
                    img.alt = `${student}çš„å¤´åƒ`;
                    
                    img.onload = function() {
                        failedImages.delete(student);
                        console.log(`æˆåŠŸé‡æ–°åŠ è½½ ${student} çš„å¤´åƒ`);
                        
                        if (failedImages.size === 0) {
                            statusElement.textContent = `å…¨éƒ¨å¤´åƒåŠ è½½å®Œæˆ`;
                            statusElement.className = 'success';
                        } else {
                            statusElement.textContent = `å·²åŠ è½½ ${students.length - failedImages.size}/${students.length} ä¸ªå¤´åƒ`;
                            statusElement.className = 'loading';
                        }
                    };
                    
                    img.onerror = function() {
                        console.log(`é‡æ–°åŠ è½½ ${student} çš„å¤´åƒå¤±è´¥ï¼Œå°†åœ¨ä¸‹æ¬¡é‡è¯•`);
                    };
                    
                    preloadContainer.appendChild(img);
                });
            }, 60000); // 1åˆ†é’Ÿé‡è¯•ä¸€æ¬¡
        }
        
        // å¯åŠ¨å¾—åˆ†æ¦œè‡ªåŠ¨æ›´æ–°æœºåˆ¶
        function startScoreboardAutoUpdate() {
            if (scoreboardAutoUpdateInterval) {
                clearInterval(scoreboardAutoUpdateInterval);
            }
            
            // é¦–æ¬¡æ›´æ–°åï¼Œæ¯3åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°ä¸€æ¬¡
            scoreboardAutoUpdateInterval = setInterval(() => {
                console.log('è‡ªåŠ¨æ›´æ–°å¾—åˆ†æ¦œæ•°æ®...');
                updateScoreboardCache();
            }, 180000); // 3åˆ†é’Ÿ
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            
            // GitHub Token è®¾ç½®åŠŸèƒ½
            const tokenSection = document.getElementById('githubTokenSection');
            const tokenToggle = document.getElementById('tokenToggle');
            const saveTokenBtn = document.getElementById('saveToken');
            
            // åˆ‡æ¢Tokenè®¾ç½®é¢æ¿
            tokenToggle.addEventListener('click', function() {
                tokenSection.classList.toggle('collapsed');
            });
            
            // ä¿å­˜Token
            saveTokenBtn.addEventListener('click', function() {
                const token = document.getElementById('githubTokenInput').value;
                if (token) {
                    saveGitHubToken(token);
                    document.getElementById('githubTokenInput').value = '';
                    tokenSection.classList.add('collapsed');
                    
                    // Tokenä¿å­˜åï¼Œç«‹å³é¢„åŠ è½½å¾—åˆ†æ¦œæ•°æ®
                    updateScoreboardCache();
                } else {
                    showTokenStatus('è¯·è¾“å…¥Token');
                }
            });
            
            // åŠ è½½å·²ä¿å­˜çš„Token
            const savedToken = getGitHubToken();
            if (savedToken) {
                showTokenStatus('Token å·²åŠ è½½');
            }
            
            // å¾—åˆ†æ¦œåŠŸèƒ½
            document.getElementById('scoreboardBtn').addEventListener('click', showScoreboard);
            document.getElementById('refreshScoreboard').addEventListener('click', updateScoreboardCache);
            document.getElementById('downloadScoreboard').addEventListener('click', downloadScoreboardAsExcel);
            document.getElementById('closeScoreboard').addEventListener('click', function() {
                document.getElementById('scoreboardModal').style.display = 'none';
            });
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            document.getElementById('scoreboardModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
            
            // å¡«å……å­¦ç”Ÿé€‰æ‹©ä¸‹æ‹‰æ¡†
            const studentSelect = document.getElementById('studentSelect');
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student;
                option.textContent = student;
                studentSelect.appendChild(option);
            });
            
            // å¯†ç éªŒè¯ - ç‚¹å‡»ç¡®è®¤æŒ‰é’®
            document.getElementById('submitPassword').addEventListener('click', function() {
                checkPassword();
            });
            
            // å¯†ç éªŒè¯ - æŒ‰å›è½¦é”®
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
            
            function checkPassword() {
                const password = document.getElementById('passwordInput').value;
                if (password === 'math123') {
                    document.getElementById('passwordSection').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                    
                    // å¯†ç éªŒè¯é€šè¿‡åé¢„åŠ è½½æ‰€æœ‰å¤´åƒ
                    preloadStudentImages();
                    
                    // å¯†ç éªŒè¯é€šè¿‡åé¢„åŠ è½½å¾—åˆ†æ¦œæ•°æ®
                    updateScoreboardCache();
                    
                    // å¯åŠ¨å¾—åˆ†æ¦œè‡ªåŠ¨æ›´æ–°æœºåˆ¶
                    startScoreboardAutoUpdate();
                } else {
                    alert('å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼');
                    document.getElementById('passwordInput').value = '';
                    document.getElementById('passwordInput').focus();
                }
            }
            
            let isRolling = false;
            let rollInterval;
            let selectedStudent = '';
            let audio;
            
            // å¼€å§‹ç‚¹å
            document.getElementById('startBtn').addEventListener('click', function() {
                if (isRolling) return;
                
                isRolling = true;
                document.getElementById('studentImage').style.display = 'none';
                document.getElementById('studentNameInImage').style.display = 'none';
                document.getElementById('message').textContent = '';
                document.getElementById('scoreSection').style.display = 'none';
                document.getElementById('specifySection').style.display = 'none';
                
                const studentNameElement = document.getElementById('studentName');
                studentNameElement.classList.remove('selected');
                studentNameElement.classList.add('rolling');
                
                // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                audio = new Audio('music/background.mp3');
                audio.loop = true;
                audio.play().catch(e => console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e));
                
                // ä½¿ç”¨ç³»ç»Ÿæ—¶é—´ä½œä¸ºéšæœºç§å­
                const seed = Date.now();
                let currentIndex = Math.floor(Math.random() * students.length);
                
                rollInterval = setInterval(() => {
                    // ä½¿ç”¨æ›´å¤æ‚çš„éšæœºç®—æ³•ï¼Œç»“åˆç³»ç»Ÿæ—¶é—´
                    const now = Date.now();
                    const randomIndex = Math.floor((Math.sin(seed + now) + 1) * 0.5 * students.length) % students.length;
                    studentNameElement.textContent = students[randomIndex];
                }, 100);
                
                // 4ç§’ååœæ­¢
                setTimeout(() => {
                    stopRolling();
                }, 4000);
            });
            
            // åœæ­¢ç‚¹å
            document.getElementById('stopBtn').addEventListener('click', function() {
                if (!isRolling) return;
                stopRolling();
            });
            
            // æŒ‡å®šå­¦ç”Ÿ
            document.getElementById('specifyBtn').addEventListener('click', function() {
                document.getElementById('specifySection').style.display = 'block';
                document.getElementById('scoreSection').style.display = 'none';
            });
            
            // ç¡®è®¤æŒ‡å®šå­¦ç”Ÿ
            document.getElementById('confirmSpecify').addEventListener('click', function() {
                const selected = document.getElementById('studentSelect').value;
                if (!selected) {
                    alert('è¯·é€‰æ‹©ä¸€åå­¦ç”Ÿï¼');
                    return;
                }
                
                selectStudent(selected);
                document.getElementById('specifySection').style.display = 'none';
            });
            
            function stopRolling() {
                clearInterval(rollInterval);
                isRolling = false;
                
                const studentNameElement = document.getElementById('studentName');
                studentNameElement.classList.remove('rolling');
                
                // ä½¿ç”¨ç³»ç»Ÿæ—¶é—´ä½œä¸ºéšæœºç§å­é€‰æ‹©å­¦ç”Ÿ
                const seed = Date.now();
                const randomIndex = Math.floor((Math.sin(seed) + 1) * 0.5 * students.length) % students.length;
                selectedStudent = students[randomIndex];
                selectStudent(selectedStudent);
            }
            
            function selectStudent(student) {
                selectedStudent = student;
                const studentNameElement = document.getElementById('studentName');
                studentNameElement.textContent = selectedStudent;
                studentNameElement.classList.add('selected');
                
                // åœæ­¢éŸ³ä¹
                if (audio) {
                    audio.pause();
                    audio.currentTime = 0;
                }
                
                // æ˜¾ç¤ºå­¦ç”Ÿå¤´åƒå¹¶åº”ç”¨ç¾é¢œæ•ˆæœ
                const studentImage = document.getElementById('studentImage');
                studentImage.src = `images/${selectedStudent}.jpg`;
                studentImage.style.display = 'block';
                studentImage.classList.add('active');
                
                // åˆ›å»ºåº†ç¥æ•ˆæœ
                createFireworks();
                createSparkles();
                
                // æ˜¾ç¤ºæ¶ˆæ¯
                document.getElementById('message').textContent = `æ­å–œ${selectedStudent}åŒå­¦ä¸­å¥–å•¦ï¼`;
                
                // è¯­éŸ³æ’­æŠ¥
                const speech = new SpeechSynthesisUtterance(`æ­å–œ${selectedStudent}åŒå­¦ä¸­å¥–å•¦`);
                speech.lang = 'zh-CN';
                speech.rate = 1.0;
                speech.pitch = 1.0;
                window.speechSynthesis.speak(speech);
                
                // 5ç§’åéšè—å¤´åƒï¼Œæ˜¾ç¤ºå­¦ç”Ÿå§“ååœ¨å¤´åƒä½ç½®
                setTimeout(() => {
                    studentImage.style.display = 'none';
                    studentImage.classList.remove('active');
                    
                    // éšè—åŸæ¥çš„å­¦ç”Ÿå§“åæ˜¾ç¤ºåŒºåŸŸ
                    studentNameElement.style.display = 'none';
                    
                    // åœ¨å¤´åƒä½ç½®æ˜¾ç¤ºå­¦ç”Ÿå§“å
                    const studentNameInImage = document.getElementById('studentNameInImage');
                    studentNameInImage.textContent = selectedStudent;
                    studentNameInImage.style.display = 'block';
                    
                    // æ˜¾ç¤ºæ‰“åˆ†åŒºåŸŸ
                    document.getElementById('scoreSection').style.display = 'block';
                    document.getElementById('scoringStudent').textContent = selectedStudent;
                }, 5000);
            }
            
            // æäº¤åˆ†æ•°
            document.getElementById('submitScore').addEventListener('click', function() {
                const score = document.getElementById('scoreInput').value;
                
                if (score === '' || score < -100 || score > 100) {
                    alert('è¯·è¾“å…¥-100åˆ°100ä¹‹é—´çš„åˆ†æ•°ï¼');
                    return;
                }
                
                // ä¿å­˜åˆ°GitHub
                saveScoreToGitHub(selectedStudent, score);
                
                document.getElementById('scoreInput').value = '';
                document.getElementById('scoreSection').style.display = 'none';
                
                // æ¢å¤æ˜¾ç¤ºåŒºåŸŸ
                document.getElementById('studentName').style.display = 'block';
                document.getElementById('studentNameInImage').style.display = 'none';
            });
        });
    </script>
</body>
</html>
